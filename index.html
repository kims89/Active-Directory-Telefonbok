<!DOCTYPE html>
<html lang="nb">
<head>
  <script src="/js/jquery/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->


<link rel="stylesheet" href="/js/bootstrap/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="/fig/css/font-awesome.min.css">
<!-- Latest compiled and minified JavaScript -->

<script src="/js/bootstrap/bootstrap.min.js"></script>

<link rel="stylesheet" href="/js/Easy-autocomplete/easy-autocomplete.css">
<link rel="stylesheet" href="/js/Easy-autocomplete/easy-autocomplete.themes.min.css">
<script src="/js/Easy-autocomplete/jquery.easy-autocomplete.js"></script>
<style>
.eac-square input {
  background-image: url("fig/icon_search.png");
  background-repeat: no-repeat;
  background-position: right 10px center;
}
</style>
</head>
<script>


var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var table = document.getElementById("myTable");
        var jsonData = JSON.parse(this.responseText);
        for (var i = 0; i < jsonData.length; i++) {
            var counter = jsonData[i];
            var row = table.insertRow(0);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var navnHTML = counter.displayName;
            var kontaktHTML ="<a href='mailto:"+counter.mail+"'> <i class='fa fa-envelope' aria-hidden='true'></i></a> / <a href='sip:"+counter.mail+"'><i class='fa fa-skype' aria-hidden='true'></i></a>";
            var tittelHTML = ""+counter.title;
            var stedHTML = ""+counter.physicalDeliveryOfficeName;
            var selskapHTML = ""+counter.department;
            if (counter.ipPhone==undefined) {
              var telefonHTML = ""+counter.mobile;
            }
            else {
              var telefonHTML = ""+counter.mobile+" / "+counter.ipPhone;
            }

            cell1.innerHTML = navnHTML.replace("undefined","");
            cell2.innerHTML = tittelHTML.replace("undefined","");
            cell3.innerHTML = stedHTML.replace("undefined","");
            cell4.innerHTML = selskapHTML.replace("undefined","");
            cell5.innerHTML = kontaktHTML.replace("undefined","");
            cell6.innerHTML = telefonHTML.replace("undefined","");
        }

    }
};

xmlhttp.open("GET", "/search", true);
xmlhttp.send();


function searchJson(data) {
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
          var table = document.getElementById("myTable");
          var jsonData = JSON.parse(this.responseText);
          var tableHeaderRowCount = 0;
          var rowCount = table.rows.length;
          for (var i = tableHeaderRowCount; i < rowCount; i++) {
              table.deleteRow(tableHeaderRowCount);
          }
          for (var i = 0; i < jsonData.length; i++) {
              var counter = jsonData[i];
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              var cell3 = row.insertCell(2);
              var cell4 = row.insertCell(3);
              var cell5 = row.insertCell(4);
              var cell6 = row.insertCell(5);
              var navnHTML = counter.displayName;
              var kontaktHTML ="<a href='mailto:"+counter.mail+"'> <i class='fa fa-envelope' aria-hidden='true'></i></a> / <a href='sip:"+counter.mail+"'><i class='fa fa-skype' aria-hidden='true'></i></a>";
              var tittelHTML = ""+counter.title;
              var stedHTML = ""+counter.physicalDeliveryOfficeName;
              var selskapHTML = ""+counter.department;
              if (counter.ipPhone==undefined) {
                var telefonHTML = ""+counter.mobile;
              }
              else {
                var telefonHTML = ""+counter.mobile+" / "+counter.ipPhone;
              }

              cell1.innerHTML = navnHTML.replace("undefined","");
              cell2.innerHTML = tittelHTML.replace("undefined","");
              cell3.innerHTML = stedHTML.replace("undefined","");
              cell4.innerHTML = selskapHTML.replace("undefined","");
              cell5.innerHTML = kontaktHTML.replace("undefined","");
              cell6.innerHTML = telefonHTML.replace("undefined","");
          }

      }
  };
  xmlhttp.open("GET", "/search/"+data, true);
  xmlhttp.send();

}



</script>
<body>
</br>
  <div class="container">
    <div class="page-header">
        <h1>Telefonkatalog</h1>
        <p class="lead">AD-integrert telefonbok.</p>
      </div>
<div class="row">
<div class="col-md-5">


<div class="well">
    <input type="text" id="provider-json" class="form-control" placeholder="SÃ¸k etter navn..." />
</div>
  </div>




</div>


  <div class="table-responsive">
  </br>
            <table id="tableId" class="table table-striped">
              <thead>
                <tr>
                  <th>Navn</th>
                  <th>Tittel</th>
                  <th>Sted</th>
                  <th>Selskap</th>
                  <th><i class="fa fa-id-card" aria-hidden="true"></i></th>
                  <th><i class="fa fa-phone" aria-hidden="true"></i></th>
                </tr>
              </thead>
              <tbody id="myTable">
              </tbody>
            </table>
  </div>
  </div><!-- /.container -->
          <script>


          function sokEnter() {
              var x = document.getElementById("provider-json").value;
              searchJson(x);
          }

          document.getElementById("provider-json")
              .addEventListener("keyup", function(event) {
              event.preventDefault();
              if (event.keyCode == 13) {
                  sokEnter();
              }
          });


          var options = {
            url: "/search",

            getValue: "displayName",



            list: {
              match: {
                enabled: true
              },showAnimation: {
			          type: "fade"
		          },
		          hideAnimation: {
			          type: "fade"
		          },
              onClickEvent: function() {
                var value = $("#provider-json").getSelectedItemData().displayName;
                searchJson(value);
              },
              onChooseEvent: function() {
                var value = $("#provider-json").getSelectedItemData().displayName;
                searchJson(value);
              }

            },
            theme: "square"
          };

          $("#provider-json").easyAutocomplete(options);

          </script>
</body>
</html>
