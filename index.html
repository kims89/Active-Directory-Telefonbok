<html>
<head>
  <script src="/js/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="/js/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="/js/bootstrap-theme.min.css" >

<!-- Latest compiled and minified JavaScript -->
<script src="/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/js/easy-autocomplete.css">
<script src="/js/jquery.easy-autocomplete.js"></script>
</head>
<script>


var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var table = document.getElementById("myTable");
        var jsonData = JSON.parse(this.responseText);
        for (var i = 0; i < jsonData.length; i++) {
            var counter = jsonData[i];
            var row = table.insertRow(0);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var navnHTML = counter.displayName+" <a href='mailto:"+counter.mail+"'>E-post</a> / <a href='sip:"+counter.mail+"'>Skype</a>";
            var tittelHTML = ""+counter.title;
            var stedHTML = ""+counter.physicalDeliveryOfficeName;
            var selskapHTML = ""+counter.department;
            if (counter.ipPhone==null) {
              var telefonHTML = ""+counter.mobile;
            }
            else {
              var telefonHTML = ""+counter.mobile+" / "+counter.ipPhone;
            }

            cell1.innerHTML = navnHTML.replace("undefined","");
            cell2.innerHTML = tittelHTML.replace("undefined","");
            cell3.innerHTML = stedHTML.replace("undefined","");
            cell4.innerHTML = selskapHTML.replace("undefined","");
            cell5.innerHTML = telefonHTML.replace("undefined","");
        }

    }
};
xmlhttp.open("GET", "/alle", true);
xmlhttp.send();


function searchJson(data) {
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
          var table = document.getElementById("myTable");
          var jsonData = JSON.parse(this.responseText);
          var tableHeaderRowCount = 0;
          var rowCount = table.rows.length;
          for (var i = tableHeaderRowCount; i < rowCount; i++) {
              table.deleteRow(tableHeaderRowCount);
          }
          for (var i = 0; i < jsonData.length; i++) {
              var counter = jsonData[i];
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              var cell3 = row.insertCell(2);
              var cell4 = row.insertCell(3);
              var cell5 = row.insertCell(4);
              var navnHTML = counter.displayName+" <a href='mailto:"+counter.mail+"'>E-post</a> / <a href='sip:"+counter.mail+"'>Skype</a>";
              var tittelHTML = ""+counter.title;
              var stedHTML = ""+counter.physicalDeliveryOfficeName;
              var selskapHTML = ""+counter.department;
              var telefonHTML = ""+counter.mobile;

              cell1.innerHTML = navnHTML.replace("undefined","");
              cell2.innerHTML = tittelHTML.replace("undefined","");
              cell3.innerHTML = stedHTML.replace("undefined","");
              cell4.innerHTML = selskapHTML.replace("undefined","");
              cell5.innerHTML = telefonHTML.replace("undefined","");
          }

      }
  };
  xmlhttp.open("GET", "/sok/"+data, true);
  xmlhttp.send();

}
</script>
<body>
</br>
  <div class="container">
    <div class="page-header">
        <h1>Telefonkatalog</h1>
        <p class="lead">AD-integrert telefonbok.</p>
      </div>
<div class="row">
<div class="col-md-4">
      <input type="text" id="provider-json" class="form-control" placeholder="Søk etter navn..." />
</div>

      <button class="btn btn-default" type="button" onclick="sokEnter()">Søk</button>
</div>


  <div class="table-responsive">
  </br>
            <table  class="table table-striped">
              <thead>
                <tr>
                  <th>Navn</th>
                  <th>Tittel</th>
                  <th>Sted</th>
                  <th>Selskap</th>
                  <th>Telefon</th>
                </tr>
              </thead>
              <tbody id="myTable">
              </tbody>
            </table>
  </div>

  </div><!-- /.container -->
          <script>
          function sokEnter() {
              var x = document.getElementById("provider-json").value;
              searchJson(x);
              if(x==""){
                location.reload();
              }
          }


          var options = {
            url: "/alle",

            getValue: "displayName",

            list: {
              match: {
                enabled: true
              },
              onClickEvent: function() {
                var value = $("#provider-json").getSelectedItemData().displayName;
                searchJson(value);
              },
              onChooseEvent: function() {
                var value = $("#provider-json").getSelectedItemData().displayName;
                searchJson(value);
              }
            }
          };

          $("#provider-json").easyAutocomplete(options);

          </script>
</body>
</html>
